== Deformation model definition

The deformation model is characterized as follows.

////
2. [[funcmod-trajectory]]The model defines a trajectory for each point on the physical surface by adding the calculated displacement as function of time to the position used to evaluate the spatial function.  This trajectory is terms of an explicitly defined accessible coordinate system.

3. [[funcmod-ref-crs]]The position used to calculate the spatial function is not defined in an currently accessible coordinate system - it may be in terms on an accessible coordinate system at a specific epoch.  Its value is only accessible by an inverse calculation using the model.  See the <<formula-inverse>> below.
////
////
10. [[funcmod-spatial-params-other]] A producer may include additional parameters at each node that will be ignored by compliant software.  The set of parameters must be the same for each node of a spatial function.
////


1. [[funcmod-extents]] The model defines deformation within a specified spatial and temporal extent. Beyond these extents the model is undefined and cannot be evaluated.

2. [[funcmod-decomposition]]The model partitions deformation into one or more elements. The total displacement at a specific time and position is calculated by summing the contribution from each element at that time and position as described in <<formula-elements>>.

3. [[funcmod-element]]Each element of the model comprises a spatial function and a time function. The spatial function evaluates displacement as a function of position. The time function evaluates a scale factor as a function of time. The deformation contribution for the element at a given position and time is obtained by multiplying the displacement from the spatial function by the scale factor from the time function.

4. [[funcmod-spatial-extent]]The spatial function may be defined over a subset of the total extent of the model. Where the spatial function is not defined it is assumed to be zero.

5. [[funcmod-spatial-function]]The spatial function is represented by displacement vectors at the nodes of a grid or a set of nested grids.

+
--
The grids must conform to the following requirements:

* Grids rows are equally spaced 
* Grid columns equally spaced. 
* Grid rows and columns are aligned with the axes of the definition CRS 
* Grids may intersect at a one or more common edges but otherwise may not intersect unless one of the grids is fully contained by the other grid.
* Grid cells of one grid intersect at a one or more common edges with grid cells of another grid but otherwise may not intersect unless one of the cells is fully contained by the other.

To evaluate the spatial function at a specific position, the nesting algorithm identifies a single grid applicable at that position. The spatial function displacement components are calculated from just that grid, using the formulae. This calculation described in <<formula-spatial-interpolation>>.
--

6. [[funcmod-spatial-params]]The spatial function can define displacement and uncertainty components.  This set of components must be defined at every node of every grid of the function.  Different spatial functions may have different components.  For example, one function might define horizontal displacement and another may define vertical displacement.

7. [[funcmod-spatial-params-displacement]]Displacement components of the spatial function may include:
* horizontal displacement - the east and north displacement in meters or degrees
* vertical displacement - the upwards vertical displacement in meters.

+
Displacement components not defined by the spatial function are assumed to be zero.

8. [[funcmod-spatial-params-uncertainty]]Uncertainty components of the spatial function may be one of:

* horizontal uncertainty specified as one of:
** horizontal circular uncertainty e~h~
** east and north uncertainty e~e~, e~n~
** horizontal covariance matrix components c~ee~ , c~en~, c~nn~.
* vertical uncertainty  e~v~
* horizontal and vertical uncertainty
* covariance of horizontal and vertical displacement components c~ee~ , c~en~, c~nn~, c~eu~, c~nu~, c~uu~

+
--
The components used to represent uncertainty are defined in the model metadata and must be the same for all spatial functions which have uncertainty components.

The probability level for the uncertainty is defined in the model metadata, e.g. "1 standard error", "95% confidence".

If the uncertainty is not defined at a model node its value is defined in the element metadata or, if it is not defined there, in the model metadata.
--

9. [[funcmod-spatial-params-quality]] A spatial function may include a quality parameter at each node providing guidance on the reliability of the spatial function in the vicinity of the node. For example, a quality parameter could indicate surface faulting affecting cells adjacent to the node.

10. [[funcmod-continuous-invertible]]
The displacement defined by the model is required to be continuous and invertible within the spatial and temporal extent of the model except where it evaluates to _no data_.
This is not necessarily enforced by the mathematical formulation of a model. It is a compliance requirement on producers of functional models and thus can be assumed by software implementations of the model.

11. [[funcmod-nodata]] The displacement and uncertainty components at a node of a spatial function may be assigned a  _no data_ value.  This means that their value at that node is undefined.  The model displacement and uncertainty is undefined at specific time and location if calculating it would require using a using a _no data_ value.

14. [[funcmod-time-function]]The time function is a scalar function of time calculated as the sum of one or more base functions. Each base function is one of:
 * a velocity function
 * a step function
 * a reverse step function
 * a ramp function
 * an exponential decay function
 * a logarithmic function
 * an acceleration function
 * a hyperbolic tangent function
 * a sine or cosine function

+
These base time functions are defined mathematically in <<formula-time-function>>.

15. The model may define a 14 parameter Bursa-Wolf transformation definition.  This is applied after the displacement calculated from the deformation elements in a forward transformation or before it in an inverse transformation as described in <<formula-14prm-transformation>>.


16. [[funcmod-element-metadata]]Each element definition includes metadata defining:

* The type of spatial function (grid)
* The spatial interpolation method to use
* The quantities it defines (displacements, uncertainties)
* A spatial definition of the extent of the spatial function (to determine if it is required at a specific position)

+
--
It may also include:

* The default horizontal and vertical uncertainty which applies if the spatial function does not explicitly define uncertainty.
* Other metadata required by the implementation
* Other producer metadata

////
* definition of areas where quality is impacted, for example where there is surface faulting. The areas each include a description, multipolygon defining the extent of the affected area, and a start and end epoch for the event causing the unmodelled deformation. See <<discuss-params-quality>> below.
////
--

17. [[funcmod-model-metadata]]The model definition includes metadata defining:

* The version of this specification with which the model complies
* The name of the model
* The version of the model
* The publication date
* The licence under which the model is published
* A description of the model
* Contact information for the agency publishing the model
* The source CRS definition (e.g. EPSG:xxxx)
* The target CRS definition (if the model is implemented as a point motion model this will be the same as the source CRS).
* The spatial function definition CRS
* The units of horizontal displacement
* The units of vertical displacement
* The default horizontal and vertical uncertainty for each element of the model
* The parameters representing uncertainty at each spatial function node, e.g. horizontal covariance, vertical uncertainty
* the probability level of uncertainties in the model, e.g. 95% confidence level
* The spatial extent of the model
* The time extent of the model
* The algorithm used to apply the calculated displacement to an input coordinate.

+
--
It may also include:

* Links to reference information about the model
* Other metadata required by the implementation
* Other producer metadata
--