== [[section-model-definition]] Deformation model definition

The deformation model is characterized as follows.

. [[funcmod-extents]] The model defines deformation within a specified spatial and temporal extent. Beyond these extents it is undefined and cannot be evaluated.

. [[funcmod-decomposition]]The model partitions deformation into one or more elements. The total displacement at a specific time and position is calculated by summing the contribution from each element at that time and position, as described in <<formula-elements>>.

. [[funcmod-element]]Each element of the model comprises a spatial function and a time function. The spatial function evaluates displacement as a function of position. The time function evaluates a scale factor as a function of time. The deformation contribution for the element at a given position and time is obtained by multiplying the displacement from the spatial function by the scale factor from the time function.  This structure is illustrated in <<image_structure>>.

+
--
[[image_structure]]
image::structure.png[title="Functional decomposition of a deformation model",width=600,pdfwidth=15cm]
--

. [[funcmod-spatial-extent]]The spatial function may be defined over a subset of the total extent of the model. Where the spatial function is not defined within the extent of the model it is assumed to be zero.  This allows an element to represent a deformation event that does not affect the full extent of the model.

. [[funcmod-spatial-function]]The spatial function is represented by displacement vectors at the nodes of a grid or set of grids. 

+
If a set of grids is given, then only one of the grids will be used to evaluate the function at a specific location.  The implementation must unambiguously define which grid (if any) is to be used at a specific location.

. [[funcmod-spatial-interpolation]]The spatial function displacement components at a location are calculated from the selected grid using a specified interpolation method.  The only interpolation method explicitly supported is bilinear interpolation, as described in  <<formula-spatial-interpolation>>.  

+
A producer may specify other formulae supported by implementations, but this AS provides no assurance of the displacements an implementation will calculate from such a model.


. [[funcmod-spatial-params]]The spatial function can define displacement and uncertainty components.  This set of components must be defined at every node of every grid of the function.  Different spatial functions may have different components.  For example, the spatial function of one element might define horizontal displacement, and the spatial function of another may define vertical displacement.

. [[funcmod-spatial-params-displacement]]Displacement components of the spatial function may include:
* Horizontal displacement - the east and north displacement in meters or degrees
* Vertical displacement - the upwards vertical displacement in meters.

+
Displacement components not defined by the spatial function are assumed to be zero.

. [[funcmod-spatial-params-uncertainty]]Uncertainty components of the spatial function may include:

* Horizontal uncertainty specified as one of:
** horizontal circular uncertainty e~h~
** east and north uncertainty e~e~, e~n~
* Vertical uncertainty  e~v~

+
--
The set of components used to represent uncertainty are defined in the model metadata and must be used for all spatial functions which have uncertainty components.  For example, the deformation metadata could specify that the model uses horizontal circular uncertainty and vertical uncertainty.  A particular spatial component could define just horizontal circular uncertainty.  Another could define vertical uncertainty.  However, it would not be valid for one element to define east and north uncertainty and another to define horizontal circular uncertainty.

// * horizontal and vertical uncertainty
// ** horizontal covariance matrix components c~ee~ , c~en~, c~nn~.
// * covariance of horizontal and vertical displacement components c~ee~ , c~en~, c~nn~, c~eu~, c~nu~, c~uu~

The probability level for the uncertainty is defined in the model metadata, e.g., "1 standard error", "95% confidence".

If the uncertainty of an element is not defined at a grid node, then the uncertainty is taken from a default value in the element metadata or, if it is not defined there, in the model metadata.

// . [[funcmod-spatial-params-quality]] A spatial function may include a quality parameter at each node providing guidance on the reliability of the spatial function in the vicinity of the node. For example, a quality parameter could indicate surface faulting affecting cells adjacent to the node.
--

. [[funcmod-nodata]] The displacement and uncertainty components at a node of a spatial function may be assigned a  _no-data_ value meaning that their value is undefined at that node.  A calculated  displacement or uncertainty is considered undefined at a specific time and location if calculating its value uses a _no-data_ value. 

. [[funcmod-continuous-invertible]]
The displacement defined by the model is required to be continuous within the spatial and temporal extent of the model except where it evaluates to _no-data_.
This is not necessarily enforced by the mathematical formulation of a model. It is a compliance requirement on producers of deformation models.  Continuity can be assumed by software implementations of the model.


. [[funcmod-time-function]]The time function of an element is a scalar function of time calculated as the sum of one or more base functions. Each base function is one of:
 * a velocity function
 * a step function
 * a ramp function
 * an exponential decay function
 * a logarithmic function
 * an acceleration function
 * a hyperbolic tangent function
 * a cyclic function

+
These base time functions are defined in <<formula-time-function>>.

. [[funcmod-element-metadata]]Each element definition specifies:

* The spatial interpolation method to be used (currently only bilinear is supported)
* The quantities it defines (displacement components, uncertainty components)
* A spatial definition of the extent of the spatial function (to determine if it is required at a specific position)

+
--
// * The type of spatial function (grid).  This may be specified by implication if the carrier only supports grid format. 
An element may may also specify:

* The default uncertainty that applies if the spatial function does not explicitly define uncertainty.
* Other metadata required by the implementation
* Other producer metadata

////
* definition of areas where quality is impacted, ,for example where there is surface faulting. The areas each include a description, multipolygon defining the extent of the affected area, and a start and end epoch for the event causing the unmodeled deformation. See <<discuss-params-quality>> below.
////
--

. [[funcmod-model-metadata]]The model definition specifies:

* The source CRS
* The target CRS (if the model is implemented as a point motion model this will be the same as the source CRS).
* The interpolation CRS used to define the spatial function(s)
* The valid spatial extent of the model (defined in terms of the interpolation CRS)
* The valid time extent of the model
* The units of horizontal displacement
* The units of vertical displacement
* The parameters used to represent uncertainty, for example, horizontal 95% circular confidence, vertical 95% confidence level.
* The default uncertainty for each element of the model, used if the element does not explicitly define uncertainty

+
--

The model definition may also specify:

* Other metadata required by the implementation, such as discovery metadata and license information.
* Other producer metadata, such as model name, model version and publication date.
--